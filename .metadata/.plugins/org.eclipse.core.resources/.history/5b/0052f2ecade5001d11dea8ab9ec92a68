package com.example.demo.service;

import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Sort;
import org.springframework.data.domain.Sort.Direction;
import org.springframework.stereotype.Service;

import com.example.demo.model.Books;
import com.example.demo.repository.BooksRepository;

@Service 
public class BooksService {

@Autowired
BooksRepository booksRepository;  

public List<Books> getAllBooks()   
{  
List<Books>bookList = (List<Books>) booksRepository.findAll();  

return bookList;  
}    
  
public Books saveBooks(Books u)   
{  
return booksRepository.save(u);  
}  
  
public  Books updateBook(Books s,int rno) {
	Optional<Books> optional=booksRepository.findById(rno);
	Books obj=null;
	if(optional.isPresent())
	{
		obj=optional.get();
		obj.setBookid(s.getBookid());
		obj.setBookname(s.getBookname());
		obj.setAuthor(s.getAuthor());
		obj.setPrice(s.getPrice());
		obj.setGenre(s.getGenre());
		obj.setGenre_id(s.getGenre_id());
		obj.setPublisher_id(s.getPublisher_id());
		obj.setPublisher_name(s.getPublisher_name());
		obj.setAuthor_id(s.getAuthor_id());
		obj.setRating(s.getRating());
		
	booksRepository.saveAndFlush(s);
	}
	return obj;	
}

public void delete(int id)   
{  
booksRepository.deleteById(id);  
}  
public Books getBooksById(int id)   
{  

return booksRepository.findById(id).get();  
}
public List<Books>sortBooks(String field)
{
	  // return studRepo.findAll(Sort.by(field));
	   return booksRepository.findAll(Sort.by(Direction.DESC,field));
}


public List<Books> pagingBooks(int num, int size) {
	Page<Books> obj= booksRepository.findAll(PageRequest.of(num, size));
	return obj.getContent();
}

public List<Books> paginate(int num, int size, String price) 
{
	Page<Books> obj=booksRepository.findAll(PageRequest.of(num, size,Sort.by(price).descending()));
	return obj.getContent();
}

public List<Books> fetchBooksByBooknamePrefix(String prefix)
{
	  return booksRepository.findByBooknameStartingWith(prefix);
}

public List<Books> fetchBooksByBooknameSuffix(String suffix)
{
	  return booksRepository.findByBooknameEndingWith(suffix);
}

public List<Books> findByAuthor(String author)
{
	  return booksRepository.findByAuthor(author);
}
}
